{% extends "base.html" %}

{% block title %}
    Range Result
{% endblock %}

{% block body %}
    <h1>Range results</h1>

    <div id="chart-with-lines">
        <h2>Chart With Lines</h2>
        <svg></svg>
    </div>

    <div id="chart_values">
        <h2>Values</h2>
        <svg></svg>
    </div>

    <div id="chart_histogram">
        <h2>Histogram</h2>
        <svg></svg>
    </div>

    <div>
        <h2>Statistics</h2>
        <table id="range_statistics" class="display">
            <thead>
            <tr>
                <th>Measure</th>
                <th>Value</th>
            </tr>
            </thead>
            <tbody>
            {% for measure, value in result.statistics.items %}
                <tr>
                    <td>{{ measure }}</td>
                    <td>{{ value }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}

{% block javascript %}
    <script type="text/javascript">
        range_data_values = {{ values|safe }};
        curve_values = {{ curve_values|safe }};

        data = [
            {
                "key": "Range",
                "bar": true,
                "values": range_data_values
            },
            {
                "key": "Curve",
                "values": curve_values
            }
        ]

        nv.addGraph(function () {
            var chart = nv.models.linePlusBarChart()
                            .margin({top: 30, right: 60, bottom: 50, left: 70})
                        //We can set x data accessor to use index. Reason? So the bars all appear evenly spaced.
                            .x(function (d, i) {
                                return i
                            })
                            .y(function (d, i) {
                                return d[1]
                            });

            chart.y1Axis.tickFormat(d3.format(',f'));
            chart.y2Axis.tickFormat(d3.format(',f'));
            chart.bars.forceY([0]);

            d3.select('#chart-with-lines svg')
                    .datum(data)
                    .transition()
                    .duration(500)
                    .call(chart);

            nv.utils.windowResize(chart.update);

            return chart;
        });
    </script>

    <script type="text/javascript">
        range_data_values = {{ result.values|safe }}

                nv.addGraph(function () {
                    var chart_values = nv.models.discreteBarChart()
                            .x(function (d) {
                                return d.label
                            })
                            .y(function (d) {
                                return d.value
                            })
                            .staggerLabels(true)
                            .tooltips(false)
                            .showValues(true)

                    d3.select('#chart_values svg')
                            .datum(range_data_values)
                            .transition()
                            .duration(500)
                            .call(chart_values)
                    ;

                    nv.utils.windowResize(chart_values.update);

                    return chart_values;
                });
    </script>

    <script type="text/javascript">
        range_data_histogram = {{ result.histogram|safe }}

                nv.addGraph(function () {
                    var chart_histogram = nv.models.discreteBarChart()
                            .x(function (d) {
                                return d.label
                            })
                            .y(function (d) {
                                return d.value
                            })
                            .staggerLabels(true)
                            .tooltips(false)
                            .showValues(true)

                    d3.select('#chart_histogram svg')
                            .datum(range_data_histogram)
                            .transition()
                            .duration(500)
                            .call(chart_histogram)
                    ;

                    nv.utils.windowResize(chart_histogram.update);

                    return chart_histogram;
                });
    </script>

    <script type="text/javascript">
        $(document).ready(function () {
            $('#range_statistics').dataTable();
        });
    </script>
{% endblock %}